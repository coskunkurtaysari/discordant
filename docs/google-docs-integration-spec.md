# Google Docs Integration Specification

## Overview

The Discordant system automatically creates and manages Google Docs based on message content, file attachments, and AI analysis. This integration leverages the FileMetadata system to maintain bidirectional relationships between Discord messages and Google Docs.

## Automatic Document Creation

### Trigger Conditions

1. **PDF File Upload**: Any PDF upload to a channel
2. **Business Keywords**: Messages containing business-related terms
3. **Contract Analysis**: Files containing contract-like content
4. **Research Requests**: Messages asking for company/business research
5. **Meeting Notes**: Messages tagged as meeting content
6. **Action Items**: Messages containing task/action indicators

### Content Analysis Triggers
```typescript
const AUTO_CREATE_TRIGGERS = {
  keywords: [
    "contract", "agreement", "proposal", "analysis",
    "research", "company", "business", "report",
    "meeting notes", "action items", "summary"
  ],
  fileTypes: ["pdf", "docx", "xlsx"],
  aiConfidence: 0.75, // Minimum confidence for auto-creation
  contentLength: 200,  // Minimum message length
};
```

## Document Creation Process

### 1. Trigger Detection
```javascript
// In file processing or message analysis
const shouldCreateDoc = await analyzeMessageForDocCreation({
  content: message.content,
  fileUrl: message.fileUrl,
  aiAnalysis: fileMetadata.aiSummary,
  businessContext: fileMetadata.businessContext
});
```

### 2. Document Generation
```typescript
interface GoogleDocCreation {
  // Document metadata
  title: string;              // AI-generated title
  content: string;            // Initial content from message/file
  
  // Source information
  sourceMessageId: string;    // Original Discord message
  sourceChannelId: string;    // Discord channel
  sourceUserId: string;       // Message author
  
  // Permission settings
  permissions: {
    owner: string;            // Document owner (bot account)
    editors: string[];        // Channel members with edit access
    viewers: string[];        // Channel members with view access
    shareSettings: "private" | "restricted" | "public";
  };
  
  // Integration settings
  autoSync: boolean;          // Sync changes back to Discord
  notifyUpdates: boolean;     // Notify channel of doc updates
  templateType?: string;      // Document template to use
}
```

### 3. Content Structure
```markdown
# {AI-Generated Title}

**Source**: Discord Channel #{channel-name}
**Created**: {timestamp}
**Author**: {username}
**Message Link**: [View Original Message](discord://discordant.local/channels/{serverId}/{channelId}/{messageId})

---

## Original Message
{message.content}

## File Analysis
{ai-generated analysis if file attached}

## Extracted Content
{OCR or document text if applicable}

## Key Insights
{AI-generated insights and highlights}

## Action Items
{automatically extracted action items}

## Next Steps
{AI-suggested follow-up actions}

---
*This document was automatically generated by Discordant AI*
```

## Permission Management

### Channel-Based Permissions
```typescript
const mapChannelPermissions = (channelId: string) => {
  const channelMembers = await getChannelMembers(channelId);
  
  return {
    owner: "discordant-bot@business.com",
    editors: channelMembers
      .filter(m => m.role === "ADMIN" || m.role === "MODERATOR")
      .map(m => m.profile.email),
    viewers: channelMembers
      .filter(m => m.role === "GUEST")
      .map(m => m.profile.email),
    shareSettings: "restricted" // Only people with permissions
  };
};
```

### Dynamic Permission Updates
- **Member Joins Channel**: Automatically added to doc viewers
- **Member Leaves Channel**: Automatically removed from doc
- **Role Changes**: Permission level adjusted accordingly
- **Channel Archives**: Document access restricted to admins

## Document Templates

### 1. Business Analysis Template
```markdown
# Business Analysis: {Company Name}

## Executive Summary
[AI will populate this section]

## Company Overview
- **Name**: {extracted from content}
- **Industry**: {AI-determined}
- **Size**: {AI-estimated}
- **Location**: {extracted if available}

## Key Findings
[Bullet points of important insights]

## Recommendations
[AI-generated recommendations]

## Supporting Documents
- [Original Discord Message](link)
- [Uploaded Files](links)

## Next Steps
- [ ] Action item 1
- [ ] Action item 2
```

### 2. Contract Analysis Template
```markdown
# Contract Analysis: {Document Title}

## Document Information
- **Type**: {AI-determined contract type}
- **Parties**: {extracted parties}
- **Date**: {extracted date}
- **Value**: {extracted monetary value}

## Key Terms
[AI-extracted important clauses]

## Risk Assessment
[AI-generated risk analysis]

## Compliance Check
[Regulatory compliance notes]

## Recommendations
[Legal/business recommendations]
```

### 3. Meeting Notes Template
```markdown
# Meeting Notes: {Meeting Title}

## Meeting Details
- **Date**: {extracted from message}
- **Attendees**: {Discord channel members}
- **Channel**: #{channel-name}

## Discussion Points
[Key discussion items from message]

## Decisions Made
[Extracted decisions]

## Action Items
- [ ] {action item 1} - @{assignee}
- [ ] {action item 2} - @{assignee}

## Follow-up
[Next meeting/follow-up items]
```

## API Integration

### Google Drive API Configuration
```typescript
const GOOGLE_DOCS_CONFIG = {
  scopes: [
    'https://www.googleapis.com/auth/documents',
    'https://www.googleapis.com/auth/drive',
    'https://www.googleapis.com/auth/drive.file'
  ],
  maxDocuments: 1000,       // Per workspace
  maxFileSize: "10MB",      // For content insertion
  autoCleanup: true,        // Archive old documents
  retentionDays: 365        // Keep docs for 1 year
};
```

### Document Creation API
```typescript
async function createGoogleDoc(messageData: MessageWithMetadata): Promise<GoogleDocResult> {
  const docTitle = await generateDocumentTitle(messageData);
  const docContent = await generateDocumentContent(messageData);
  
  const doc = await googleDocs.documents.create({
    requestBody: {
      title: docTitle
    }
  });
  
  // Insert content
  await googleDocs.documents.batchUpdate({
    documentId: doc.data.documentId,
    requestBody: {
      requests: [
        {
          insertText: {
            location: { index: 1 },
            text: docContent
          }
        }
      ]
    }
  });
  
  // Set permissions
  await setDocumentPermissions(doc.data.documentId, messageData.channelId);
  
  // Store in FileMetadata
  await updateFileMetadata(messageData.messageId, {
    googleDocsUrl: doc.data.documentUrl,
    externalLinks: JSON.stringify([{
      type: "google_docs",
      url: doc.data.documentUrl,
      documentId: doc.data.documentId,
      title: docTitle,
      createdAt: new Date().toISOString()
    }])
  });
  
  return {
    documentId: doc.data.documentId,
    documentUrl: doc.data.documentUrl,
    title: docTitle,
    permissions: await getDocumentPermissions(doc.data.documentId)
  };
}
```

## Bidirectional Sync

### Discord ‚Üí Google Docs
- **Message Updates**: Update doc when original message edited
- **File Changes**: Update doc when new files added to message thread
- **Thread Updates**: Append new related messages to doc

### Google Docs ‚Üí Discord
- **Document Updates**: Notify channel when doc is edited
- **Comment Notifications**: Send Discord message when doc commented
- **Share Updates**: Notify when doc permissions change

### Sync Configuration
```typescript
interface SyncSettings {
  enableSync: boolean;
  syncDirection: "discord_to_docs" | "docs_to_discord" | "bidirectional";
  updateThreshold: number;     // Minimum chars changed to trigger sync
  notificationLevel: "all" | "major" | "none";
  conflictResolution: "discord_wins" | "docs_wins" | "manual";
}
```

## Workflow Integration

### n8n Document Workflow
```json
{
  "trigger": "message_with_business_content",
  "steps": [
    "analyze_content_for_business_value",
    "determine_document_template", 
    "generate_document_title",
    "create_google_doc",
    "populate_initial_content",
    "set_permissions",
    "notify_channel",
    "store_metadata"
  ]
}
```

### Automated Enhancements
- **AI Summaries**: Continuously update doc with AI insights
- **Related Content**: Link to related messages/files
- **Action Tracking**: Track completion of action items
- **Version History**: Maintain change log in document

## Security and Privacy

### Data Protection
- **Encryption**: All API credentials encrypted
- **Access Control**: Strict channel-based permissions
- **Audit Logging**: Track all document access/changes
- **Data Retention**: Automatic cleanup of old documents

### Compliance
- **GDPR**: Right to deletion includes Google Docs
- **SOC 2**: Audit trail for all document operations
- **Privacy**: No personal data stored in doc titles/metadata

## User Interface

### Discord Integration
```markdown
**üìÑ Document Created**
[Contract Analysis: ABC Corp Agreement](https://docs.google.com/document/d/xxx)

‚úÖ **Auto-generated** from your uploaded PDF
üîí **Permissions**: Channel members can view/edit
üìù **Template**: Business Contract Analysis
‚è∞ **Created**: 2 minutes ago

[View Document] [Edit Permissions] [Disable Auto-Sync]
```

### Document Management Commands
- `/docs list` - Show all docs for channel
- `/docs create [title]` - Manually create doc
- `/docs sync [on/off]` - Toggle auto-sync
- `/docs permissions [doc-id]` - Manage doc permissions
- `/docs template [type]` - Set default template

## Performance and Scaling

### Rate Limiting
```typescript
const RATE_LIMITS = {
  documentsPerHour: 50,        // Per channel
  documentsPerDay: 200,        // Per workspace
  apiCallsPerMinute: 100,      // Google API limits
  maxConcurrentCreations: 5    // Prevent API overload
};
```

### Optimization Strategies
- **Batch Operations**: Group multiple doc operations
- **Caching**: Cache frequently accessed docs
- **Queue Management**: Queue doc creation during high traffic
- **Fallback Handling**: Graceful degradation if Google APIs unavailable

This Google Docs integration creates a seamless bridge between Discord conversations and collaborative document creation, enabling automatic documentation of business discussions and file analysis with intelligent content generation and permission management. 